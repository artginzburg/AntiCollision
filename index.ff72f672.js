function t(t,n){return Math.random()*(n-t)+t}const n={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1};window.settings=n;class i{constructor(t,n,i){this.x=t,this.y=n,this.z=i}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new i(this.x*t,this.y*t,this.z*t)}div(t){return new i(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}}class o{constructor(t,n){this.x=t,this.y=n}add(t){return new o(this.x+t.x,this.y+t.y)}sub(t){return new o(this.x-t.x,this.y-t.y)}mul(t){return new o(this.x*t,this.y*t)}div(t){return new o(this.x/t,this.y/t)}}let e;(e||(e={})).length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)};const s=new i(0,255,0),r=new i(255,0,0),c=s.toRGB();class l{constructor(n,i,e){this.r=e,this.position=new o(n,i),this.velocity=new o(t(-4,4),t(-4,4)),this.r=e,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let n=0;n<100;++n){const o=(n+this.current_idx)%100,e=n/100;t[n]||(t[n]={}),t[n].position=this.position_history[o];const s=255*e;t[n].color=new i(0,s,0)}return t}draw(t){n.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),n.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath()}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const n=this.getVA(),i=n[0].position;t.beginPath(),n.forEach((n=>{t.lineTo(n.position.x,n.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(i.x,i.y),t.closePath(),this.applyTraceColor(t,i)}applyTraceColor(t,n){const i=t.createLinearGradient(n.x,n.y,this.position.x,this.position.y);i.addColorStop(0,"transparent"),i.addColorStop(1,c),t.strokeStyle=i,t.stroke()}}const a=1;let h=.35;const u=5e3,d=1e3,w=.2;function y(t,n){return i=t.clientX,o=t.clientY,e=n.clientX,s=n.clientY,Math.sqrt(Math.pow(i-e,2)+Math.pow(o-s,2));var i,o,e,s}const f=.01,p=.5;function v(t,i){if(!n.dragWithMouseOver)return;const o=t(i);return function(t){const n=o.sub(t.position),i=e.length(n),s=t.r;i<s&&(t.position=t.position.add(n.mul(f*(s-i))),t.velocity=t.velocity.add(n.mul(p*(s-i))))}}function x(t,n){window.addEventListener("keyup",(i=>{i.code!==t&&i.key!==t||n()}))}let g;const m=document.querySelector("canvas"),b=m.getContext("2d");function M(){m.width=window.innerWidth,m.height=window.innerHeight}M(),window.addEventListener("resize",M),function(){let t=.1;function n(n){t+=n,t<0&&(t=0),t>1&&(t=1),h=2.9*t+.1}window.addEventListener("wheel",(({deltaY:t})=>{n(-t/u)})),null!==navigator.userAgent.match(/iPhone|iPad|iPod/i)?window.addEventListener("touchmove",(t=>{(function(t){return void 0!==t.scale})(t)&&(function(t){t.scale!==a&&t.preventDefault()}(t),h=function(t){const n=h+(t-a)*w;return Math.min(3,Math.max(.1,n))}(t.scale))}),{passive:!1}):function(){let t=null;window.addEventListener("touchstart",(({touches:n})=>{n.length>1&&(t=y(n[0],n[1]))})),window.addEventListener("touchend",(()=>{t=null})),window.addEventListener("touchmove",(({touches:i})=>{if(null!==t){n((y(i[0],i[1])-t)/d)}}))}()}();let E=1,L=1,P=1,k=1;const C=[];for(let n=0;n<20;n++){const n=t(0,2*Math.PI),i=350,o=i*Math.cos(n),e=i*Math.sin(n);C.push(new l(o+.5*m.width,e+.5*m.height,t(70,5)))}var T,z,S,A;T=C,z=G,S=70,A=5,window.addEventListener("contextmenu",(n=>{n.preventDefault();const i=z(n);T.push(new l(i.x,i.y,t(S,A)))})),function(t,n,i){function o(o){const e=n(o);!function(t){if(!t)return;g=g===t?null:t}(i(e,t))}window.addEventListener("click",o),window.addEventListener("touchstart",(t=>{if(1!==t.touches.length)return;const n=t.touches[0];o({x:n.clientX,y:n.clientY})})),x("Escape",(()=>{g=null}))}(C,G,(function(t,n){for(const i of n){const n=t.sub(i.position);if(e.length(n)<i.r)return i}return null})),x("Space",(function(){k=1===E?10:1})),x("a",(function(){n.drawTraces=!n.drawTraces}));let B=0;const _={x:0,y:0};let $;function q(){return[-(t=g?g.position:$).x+.5*m.width/h,-t.y+.5*m.height/h];var t}function G(t){const n=new o(t.x,t.y),[i,e]=q(),s=new o(i,e);return n.div(h).sub(s)}window.addEventListener("mousemove",(t=>{_.x=t.x,_.y=t.y})),window.requestAnimationFrame((function t(i){P!==k&&(P+=k-P);let c=!0;if(!L){for(const t of C)t.stable=!0,t.save();c=function(t,i){let s=!0;const r=t.length,c=.01,l=new o(.5*m.width,.5*m.width),a=v(G,_);for(let i=0;i<r;i++){const o=t[i],h=l.sub(o.position);o.velocity=o.velocity.add(h.mul(c)),a?.(o);for(let c=i+1;c<r;c++){const i=t[c],r=o.position.sub(i.position),l=e.length(r),a=o.r+i.r;if(l<a){s=!1,o.stable=!1,i.stable=!1;const t=r.div(l);o.position=o.position.add(t.mul(.5*(a-l))),i.position=i.position.sub(t.mul(.5*(a-l))),n.useAntiCollisionBug||(o.velocity=o.velocity.add(t.mul(.5*(a-l))),i.velocity=i.velocity.sub(t.mul(.5*(a-l))))}}}for(let n=0;n<r;n++)t[n].stable?t[n].stableCount++:t[n].stableCount=0;return s}(C),!c&&B<200&&(B=0),c&&++B,P&&(E=P),L=E}(function(t,n){const i=.016;for(const o of t)o.position=o.position.add(o.velocity.mul(i/n));L--})(C,E),$=new o(0,0);for(const t of C){const n=B>199?1:Math.min(1,t.stableCount/255),i=s.mul(n).add(r.mul(1-n));let o=t.r;E>1&&(o=t.r),$=$.add(t.position),t.color=i}$=$.div(C.length),b.clearRect(0,0,m.width,m.height),b.save(),b.scale(h,h),b.translate(...q()),C.forEach((t=>t.draw(b))),b.fillStyle="purple",b.beginPath(),b.arc($.x,$.y,10,0,2*Math.PI),b.fill(),b.closePath(),b.restore(),window.requestAnimationFrame(t)}));