function t(t,i){return Math.random()*(i-t)+t}const i={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1};window.settings=i;class n{constructor(t,i,n){this.x=t,this.y=i,this.z=n}add(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new n(this.x*t,this.y*t,this.z*t)}div(t){return new n(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}}class o{constructor(t,i){this.x=t,this.y=i}add(t){return new o(this.x+t.x,this.y+t.y)}sub(t){return new o(this.x-t.x,this.y-t.y)}mul(t){return new o(this.x*t,this.y*t)}div(t){return new o(this.x/t,this.y/t)}}let e;(e||(e={})).length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)};const s=new n(0,255,0),r=new n(255,0,0),h=s.toRGB();class l{constructor(i,n,e){this.r=e,this.position=new o(i,n),this.velocity=new o(t(-4,4),t(-4,4)),this.r=e,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let i=0;i<100;++i){const o=(i+this.current_idx)%100,e=i/100;t[i]||(t[i]={}),t[i].position=this.position_history[o];const s=255*e;t[i].color=new n(0,s,0)}return t}draw(t){i.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),i.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath()}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const i=this.getVA(),n=i[0].position;t.beginPath(),i.forEach((i=>{t.lineTo(i.position.x,i.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(n.x,n.y),t.closePath(),this.applyTraceColor(t,n)}applyTraceColor(t,i){const n=t.createLinearGradient(i.x,i.y,this.position.x,this.position.y);n.addColorStop(0,"transparent"),n.addColorStop(1,h),t.strokeStyle=n,t.stroke()}}let c=.35;const a=5e3,u=1e3;function d(t,i){return n=t.clientX,o=t.clientY,e=i.clientX,s=i.clientY,Math.sqrt(Math.pow(n-e,2)+Math.pow(o-s,2));var n,o,e,s}const w=.01,y=.5;function p(t,n){if(!i.dragWithMouseOver)return;const o=t(n);return function(t){const i=o.sub(t.position),n=e.length(i),s=t.r;n<s&&(t.position=t.position.add(i.mul(w*(s-n))),t.velocity=t.velocity.add(i.mul(y*(s-n))))}}const f=document.querySelector("canvas"),x=f.getContext("2d");function v(){f.width=window.innerWidth,f.height=window.innerHeight}v(),window.addEventListener("resize",v),function(){let t=.1;function i(i){t+=i,t<0&&(t=0),t>1&&(t=1),c=2.9*t+.1}window.addEventListener("wheel",(({deltaY:t})=>{i(-t/a)})),function(){let t=null;window.addEventListener("touchstart",(({touches:i})=>{i.length>1&&(t=d(i[0],i[1]))})),window.addEventListener("touchend",(()=>{t=null})),window.addEventListener("touchmove",(({touches:n})=>{if(null!==t){i((d(n[0],n[1])-t)/u)}}))}()}();let g=1,m=1,b=1,M=1;const k=[];for(let i=0;i<20;i++){const i=t(0,2*Math.PI),n=350,o=n*Math.cos(i),e=n*Math.sin(i);k.push(new l(o+.5*f.width,e+.5*f.height,t(70,5)))}var C,T,z,E;C=k,T=B,z=70,E=5,window.addEventListener("click",(i=>{const n=T(i);C.push(new l(n.x,n.y,t(z,E)))})),_("Space",(function(){M=1===g?10:1})),_("a",(function(){i.drawTraces=!i.drawTraces}));let S=0;const L={x:0,y:0};let P;function A(){return[-P.x+.5*f.width/c,-P.y+.5*f.height/c]}function B(t){const i=new o(t.x,t.y),[n,e]=A(),s=new o(n,e);return i.div(c).sub(s)}function _(t,i){window.addEventListener("keyup",(n=>{n.code!==t&&n.key!==t||i()}))}window.addEventListener("mousemove",(t=>{L.x=t.x,L.y=t.y})),window.requestAnimationFrame((function t(n){b!==M&&(b+=M-b);let h=!0;if(!m){for(const t of k)t.stable=!0,t.save();h=function(t,n){let s=!0;const r=t.length,h=.01,l=new o(.5*f.width,.5*f.width),c=p(B,L);for(let n=0;n<r;n++){const o=t[n],a=l.sub(o.position);o.velocity=o.velocity.add(a.mul(h)),c?.(o);for(let h=n+1;h<r;h++){const n=t[h],r=o.position.sub(n.position),l=e.length(r),c=o.r+n.r;if(l<c){s=!1,o.stable=!1,n.stable=!1;const t=r.div(l);o.position=o.position.add(t.mul(.5*(c-l))),n.position=n.position.sub(t.mul(.5*(c-l))),i.useAntiCollisionBug||(o.velocity=o.velocity.add(t.mul(.5*(c-l))),n.velocity=n.velocity.sub(t.mul(.5*(c-l))))}}}for(let i=0;i<r;i++)t[i].stable?t[i].stableCount++:t[i].stableCount=0;return s}(k),!h&&S<200&&(S=0),h&&++S,b&&(g=b),m=g}(function(t,i){const n=.016;for(const o of t)o.position=o.position.add(o.velocity.mul(n/i));m--})(k,g),P=new o(0,0);for(const t of k){const i=S>199?1:Math.min(1,t.stableCount/255),n=s.mul(i).add(r.mul(1-i));let o=t.r;g>1&&(o=t.r),P=P.add(t.position),t.color=n}P=P.div(k.length),x.clearRect(0,0,f.width,f.height),x.save(),x.scale(c,c),x.translate(...A()),k.forEach((t=>t.draw(x))),x.fillStyle="purple",x.beginPath(),x.arc(P.x,P.y,10,0,2*Math.PI),x.fill(),x.closePath(),x.restore(),window.requestAnimationFrame(t)}));