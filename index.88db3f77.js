function t(t,e){return Math.random()*(e-t)+t}const e={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1};window.settings=e;class n{add(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new n(this.x*t,this.y*t,this.z*t)}div(t){return new n(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}constructor(t,e,n){this.x=t,this.y=e,this.z=n}}class o{add(t){return new o(this.x+t.x,this.y+t.y)}sub(t){return new o(this.x-t.x,this.y-t.y)}mul(t){return new o(this.x*t,this.y*t)}div(t){return new o(this.x/t,this.y/t)}constructor(t,e){this.x=t,this.y=e}}let i;!function(t){let e;var n;t.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.rotate=function(t,e,n){const s=Math.atan2(t.y,t.x)-Math.PI/2*e*n;return new o(Math.cos(s),Math.sin(s)).mul(i.length(t))},(n=e=t.RotationDirection||(t.RotationDirection={}))[n.Left=1]="Left",n[n.Right=-1]="Right"}(i||(i={}));const s=new n(0,255,0),r=new n(255,0,0),c=s.toRGB();class a{save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let e=0;e<100;++e){const o=(e+this.current_idx)%100,i=e/100;t[e]||(t[e]={}),t[e].position=this.position_history[o];const s=255*i;t[e].color=new n(0,s,0)}return t}draw(t){e.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),e.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath()}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const e=this.getVA(),n=e[0].position;t.beginPath(),e.forEach((e=>{t.lineTo(e.position.x,e.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(n.x,n.y),t.closePath(),this.applyTraceColor(t,n)}applyTraceColor(t,e){const n=t.createLinearGradient(e.x,e.y,this.position.x,this.position.y);n.addColorStop(0,"transparent"),n.addColorStop(1,c),t.strokeStyle=n,t.stroke()}constructor(e,n,i){this.r=i,this.position=new o(e,n),this.velocity=new o(t(-4,4),t(-4,4)),this.r=i,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}}const u=1;let l=.35;const h=5e3,d=1e3,w=.2;function f(t,e){return n=t.clientX,o=t.clientY,i=e.clientX,s=e.clientY,Math.sqrt(Math.pow(n-i,2)+Math.pow(o-s,2));var n,o,i,s}function v(){return.18/(Math.abs(-1.55/l)/15.5)}const y=.01,m=.5;function p(t,n){if(!e.dragWithMouseOver)return;const o=t(n);return function(t){const e=o.sub(t.position),n=i.length(e),s=t.r;n<s&&(t.position=t.position.add(e.mul(y*(s-n))),t.velocity=t.velocity.add(e.mul(m*(s-n))))}}function x(t,e,n=!1){window.addEventListener(n?"keydown":"keyup",(n=>{n.code!==t&&n.key!==t||e()}))}function g(t,e=300){function n(n){const o=()=>{t(n),s()};function i(){window.removeEventListener("touchend",o)}function s(){window.removeEventListener("touchmove",i)}window.addEventListener("touchend",o,{once:!0}),window.addEventListener("touchmove",i,{once:!0}),setTimeout((()=>{i(),s()}),e)}return window.addEventListener("touchstart",n),n}let L;const E={increment:"]",decrement:"[",incrementFast:"}",decrementFast:"{"},b={increment:"ArrowUp",decrement:"ArrowDown",rotateLeft:"ArrowLeft",rotateRight:"ArrowRight"},M={default:.1,fast:.3},R={default:.2};function T(t,e){const n=t.r+t.r*e;t.r=Math.max(n,5)}const A=document.querySelector("canvas"),P=A.getContext("2d");function k(){A.width=window.innerWidth,A.height=window.innerHeight}k(),window.addEventListener("resize",k),function(){let t=.1;function e(e){t+=e,t<0&&(t=0),t>1&&(t=1),l=2.9*t+.1}window.addEventListener("wheel",(({deltaY:t})=>{e(-t/h*v())})),null!==navigator.userAgent.match(/iPhone|iPad|iPod/i)?window.addEventListener("touchmove",(t=>{(function(t){return void 0!==t.scale})(t)&&(function(t){t.scale!==u&&t.preventDefault()}(t),l=function(t){const e=t-u,n=v()*w,o=l+e*w*n;return Math.min(3,Math.max(.1,o))}(t.scale))}),{passive:!1}):function(){let t=null;window.addEventListener("touchstart",(({touches:e})=>{e.length>1&&(t=f(e[0],e[1]))})),window.addEventListener("touchend",(()=>{t=null})),window.addEventListener("touchmove",(({touches:n})=>{if(null!==t){e((f(n[0],n[1])-t)/d)}}))}()}();let C=1,z=1,S=1,B=1;const _=[];for(let e=0;e<20;e++){const e=t(0,2*Math.PI),n=350,o=n*Math.cos(e),i=n*Math.sin(e);_.push(new a(o+.5*A.width,i+.5*A.height,t(70,5)))}var D,$,F,q;function G(){B=1===C?10:1}D=_,$=O,F=70,q=5,window.addEventListener("contextmenu",(e=>{e.preventDefault();const n=$(e);D.push(new a(n.x,n.y,t(F,q)))})),function(t,e,n){function o(o){const i=e(o);!function(t){if(!t)return;L=L===t?null:t}(n(i,t))}window.addEventListener("click",o),g((t=>{if(1!==t.touches.length)return;const e=t.touches[0];o({x:e.clientX,y:e.clientY})})),x("Escape",(()=>{L=null}))}(_,O,(function(t,e){for(const n of e){const e=t.sub(n.position);if(i.length(e)<n.r)return n}return null})),x(E.increment,(()=>{L&&T(L,M.default)}),!0),x(E.decrement,(()=>{L&&T(L,-M.default)}),!0),x(E.incrementFast,(()=>{L&&T(L,M.fast)}),!0),x(E.decrementFast,(()=>{L&&T(L,-M.fast)}),!0),x(b.increment,(()=>{L&&(L.velocity=L.velocity.mul(1+R.default))}),!0),x(b.decrement,(()=>{L&&(L.velocity=L.velocity.mul(1-R.default))}),!0),x(b.rotateLeft,(()=>{L&&(L.velocity=i.rotate(L.velocity,R.default,i.RotationDirection.Left))}),!0),x(b.rotateRight,(()=>{L&&(L.velocity=i.rotate(L.velocity,R.default,i.RotationDirection.Right))}),!0),x("Space",G),function(t,e=500,n=200){function o(o){const i=setTimeout((()=>{setTimeout((()=>{t(o)}),n),window.removeEventListener("touchend",s),window.removeEventListener("touchmove",r)}),e);function s(){c(),window.removeEventListener("touchmove",r)}function r(){c(),window.removeEventListener("touchend",s)}function c(){clearTimeout(i)}window.addEventListener("touchend",s,{once:!0}),window.addEventListener("touchmove",r,{once:!0})}window.addEventListener("touchstart",o)}(G),x("a",(function(){e.drawTraces=!e.drawTraces}));let I=0;const Y={x:0,y:0};let W;function X(){return[-(t=L?L.position:W).x+.5*A.width/l,-t.y+.5*A.height/l];var t}function O(t){const e=new o(t.x,t.y),[n,i]=X(),s=new o(n,i);return e.div(l).sub(s)}window.addEventListener("mousemove",(t=>{Y.x=t.x,Y.y=t.y})),window.requestAnimationFrame((function t(n){S!==B&&(S+=B-S);let c=!0;if(!z){for(const t of _)t.stable=!0,t.save();c=function(t,n){let s=!0;const r=t.length,c=.01,a=new o(.5*A.width,.5*A.width),u=p(O,Y);for(let n=0;n<r;n++){const o=t[n],l=a.sub(o.position);o.velocity=o.velocity.add(l.mul(c)),null==u||u(o);for(let c=n+1;c<r;c++){const n=t[c],r=o.position.sub(n.position),a=i.length(r),u=o.r+n.r;if(a<u){s=!1,o.stable=!1,n.stable=!1;const t=r.div(a);o.position=o.position.add(t.mul(.5*(u-a))),n.position=n.position.sub(t.mul(.5*(u-a))),e.useAntiCollisionBug||(o.velocity=o.velocity.add(t.mul(.5*(u-a))),n.velocity=n.velocity.sub(t.mul(.5*(u-a))))}}}for(let e=0;e<r;e++)t[e].stable?t[e].stableCount++:t[e].stableCount=0;return s}(_),!c&&I<200&&(I=0),c&&++I,S&&(C=S),z=C}(function(t,e){const n=.016;for(const o of t)o.position=o.position.add(o.velocity.mul(n/e));z--})(_,C),W=new o(0,0);for(const t of _){const e=I>199?1:Math.min(1,t.stableCount/255),n=s.mul(e).add(r.mul(1-e));let o=t.r;C>1&&(o=t.r),W=W.add(t.position),t.color=n}W=W.div(_.length),P.clearRect(0,0,A.width,A.height),P.save(),P.scale(l,l),P.translate(...X()),_.forEach((t=>t.draw(P))),P.fillStyle="purple",P.beginPath(),P.arc(W.x,W.y,10,0,2*Math.PI),P.fill(),P.closePath(),P.restore(),window.requestAnimationFrame(t)}));