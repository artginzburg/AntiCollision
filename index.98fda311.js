function t(t,n){return Math.random()*(n-t)+t}const n={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1};window.settings=n;class i{constructor(t,n,i){this.x=t,this.y=n,this.z=i}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new i(this.x*t,this.y*t,this.z*t)}div(t){return new i(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}}class e{constructor(t,n){this.x=t,this.y=n}add(t){return new e(this.x+t.x,this.y+t.y)}sub(t){return new e(this.x-t.x,this.y-t.y)}mul(t){return new e(this.x*t,this.y*t)}div(t){return new e(this.x/t,this.y/t)}}let o;(o||(o={})).length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)};const s=new i(0,255,0),r=new i(255,0,0),c=s.toRGB();class a{constructor(n,i,o){this.r=o,this.position=new e(n,i),this.velocity=new e(t(-4,4),t(-4,4)),this.r=o,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let n=0;n<100;++n){const e=(n+this.current_idx)%100,o=n/100;t[n]||(t[n]={}),t[n].position=this.position_history[e];const s=255*o;t[n].color=new i(0,s,0)}return t}draw(t){n.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),n.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath()}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const n=this.getVA(),i=n[0].position;t.beginPath(),n.forEach((n=>{t.lineTo(n.position.x,n.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(i.x,i.y),t.closePath(),this.applyTraceColor(t,i)}applyTraceColor(t,n){const i=t.createLinearGradient(n.x,n.y,this.position.x,this.position.y);i.addColorStop(0,"transparent"),i.addColorStop(1,c),t.strokeStyle=i,t.stroke()}}const l=1;let u=.35;const h=5e3,d=1e3,w=.2;function f(t,n){return i=t.clientX,e=t.clientY,o=n.clientX,s=n.clientY,Math.sqrt(Math.pow(i-o,2)+Math.pow(e-s,2));var i,e,o,s}function y(){return.18/(Math.abs(-1.55/u)/15.5)}const p=.01,v=.5;function x(t,i){if(!n.dragWithMouseOver)return;const e=t(i);return function(t){const n=e.sub(t.position),i=o.length(n),s=t.r;i<s&&(t.position=t.position.add(n.mul(p*(s-i))),t.velocity=t.velocity.add(n.mul(v*(s-i))))}}function m(t,n){window.addEventListener("keyup",(i=>{i.code!==t&&i.key!==t||n()}))}let g;const b=document.querySelector("canvas"),E=b.getContext("2d");function M(){b.width=window.innerWidth,b.height=window.innerHeight}M(),window.addEventListener("resize",M),function(){let t=.1;function n(n){t+=n,t<0&&(t=0),t>1&&(t=1),u=2.9*t+.1}window.addEventListener("wheel",(({deltaY:t})=>{n(-t/h*y())})),null!==navigator.userAgent.match(/iPhone|iPad|iPod/i)?window.addEventListener("touchmove",(t=>{(function(t){return void 0!==t.scale})(t)&&(function(t){t.scale!==l&&t.preventDefault()}(t),u=function(t){const n=t-l,i=y()*w,e=u+n*w*i;return Math.min(3,Math.max(.1,e))}(t.scale))}),{passive:!1}):function(){let t=null;window.addEventListener("touchstart",(({touches:n})=>{n.length>1&&(t=f(n[0],n[1]))})),window.addEventListener("touchend",(()=>{t=null})),window.addEventListener("touchmove",(({touches:i})=>{if(null!==t){n((f(i[0],i[1])-t)/d)}}))}()}();let L=1,T=1,P=1,k=1;const C=[];for(let n=0;n<20;n++){const n=t(0,2*Math.PI),i=350,e=i*Math.cos(n),o=i*Math.sin(n);C.push(new a(e+.5*b.width,o+.5*b.height,t(70,5)))}var z,S,A,B;function _(){k=1===L?10:1}z=C,S=Y,A=70,B=5,window.addEventListener("contextmenu",(n=>{n.preventDefault();const i=S(n);z.push(new a(i.x,i.y,t(A,B)))})),function(t,n,i){function e(e){const o=n(e);!function(t){if(!t)return;g=g===t?null:t}(i(o,t))}window.addEventListener("click",e),window.addEventListener("touchstart",(t=>{if(1!==t.touches.length)return;const n=t.touches[0];e({x:n.clientX,y:n.clientY})})),m("Escape",(()=>{g=null}))}(C,Y,(function(t,n){for(const i of n){const n=t.sub(i.position);if(o.length(n)<i.r)return i}return null})),m("Space",_),function(t,n=500,i=200){window.addEventListener("touchstart",(e=>{const o=setTimeout((()=>{setTimeout((()=>{t(e)}),i)}),n);function s(){clearTimeout(o)}window.addEventListener("touchend",s),window.addEventListener("touchmove",s)}))}(_),m("a",(function(){n.drawTraces=!n.drawTraces}));let $=0;const q={x:0,y:0};let G;function R(){return[-(t=g?g.position:G).x+.5*b.width/u,-t.y+.5*b.height/u];var t}function Y(t){const n=new e(t.x,t.y),[i,o]=R(),s=new e(i,o);return n.div(u).sub(s)}window.addEventListener("mousemove",(t=>{q.x=t.x,q.y=t.y})),window.requestAnimationFrame((function t(i){P!==k&&(P+=k-P);let c=!0;if(!T){for(const t of C)t.stable=!0,t.save();c=function(t,i){let s=!0;const r=t.length,c=.01,a=new e(.5*b.width,.5*b.width),l=x(Y,q);for(let i=0;i<r;i++){const e=t[i],u=a.sub(e.position);e.velocity=e.velocity.add(u.mul(c)),l?.(e);for(let c=i+1;c<r;c++){const i=t[c],r=e.position.sub(i.position),a=o.length(r),l=e.r+i.r;if(a<l){s=!1,e.stable=!1,i.stable=!1;const t=r.div(a);e.position=e.position.add(t.mul(.5*(l-a))),i.position=i.position.sub(t.mul(.5*(l-a))),n.useAntiCollisionBug||(e.velocity=e.velocity.add(t.mul(.5*(l-a))),i.velocity=i.velocity.sub(t.mul(.5*(l-a))))}}}for(let n=0;n<r;n++)t[n].stable?t[n].stableCount++:t[n].stableCount=0;return s}(C),!c&&$<200&&($=0),c&&++$,P&&(L=P),T=L}(function(t,n){const i=.016;for(const e of t)e.position=e.position.add(e.velocity.mul(i/n));T--})(C,L),G=new e(0,0);for(const t of C){const n=$>199?1:Math.min(1,t.stableCount/255),i=s.mul(n).add(r.mul(1-n));let e=t.r;L>1&&(e=t.r),G=G.add(t.position),t.color=i}G=G.div(C.length),E.clearRect(0,0,b.width,b.height),E.save(),E.scale(u,u),E.translate(...R()),C.forEach((t=>t.draw(E))),E.fillStyle="purple",E.beginPath(),E.arc(G.x,G.y,10,0,2*Math.PI),E.fill(),E.closePath(),E.restore(),window.requestAnimationFrame(t)}));