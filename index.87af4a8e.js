function t(t,e){return Math.random()*(e-t)+t}const e={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1,bounciness:0};window.settings=e;class n{add(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new n(this.x*t,this.y*t,this.z*t)}div(t){return new n(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}constructor(t,e,n){this.x=t,this.y=e,this.z=n}}class i{add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}mul(t){return new i(this.x*t,this.y*t)}div(t){return new i(this.x/t,this.y/t)}constructor(t,e){this.x=t,this.y=e}}let o;!function(t){let e;var n;t.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.rotate=function(t,e,n){const s=Math.atan2(t.y,t.x)-Math.PI/2*e*n;return new i(Math.cos(s),Math.sin(s)).mul(o.length(t))},(n=e=t.RotationDirection||(t.RotationDirection={}))[n.Left=1]="Left",n[n.Right=-1]="Right"}(o||(o={}));const s=new n(0,255,0),r=new n(255,0,0),c=s.toRGB();function a(t){const e=t.reduce(((t,e)=>t.stableScore<e.stableScore?t:e));t.forEach((t=>{t.hasLeastStableScore=!1})),e.hasLeastStableScore=!0}function u(t){t.stableScore+=t.stableCount}function l(t,e){e.hasLeastStableScore&&(t.fillStyle="#fffd",t.beginPath(),t.arc(e.position.x,e.position.y,e.r/5,0,2*Math.PI),t.fill(),t.closePath())}class h{save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let e=0;e<100;++e){const i=(e+this.current_idx)%100,o=e/100;t[e]||(t[e]={}),t[e].position=this.position_history[i];const s=255*o;t[e].color=new n(0,s,0)}return t}draw(t){e.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),e.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath(),this.drawStableScore(t)}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const e=this.getVA(),n=e[0].position;t.beginPath(),e.forEach((e=>{t.lineTo(e.position.x,e.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(n.x,n.y),t.closePath(),this.applyTraceColor(t,n)}applyTraceColor(t,e){const n=t.createLinearGradient(e.x,e.y,this.position.x,this.position.y);n.addColorStop(0,"transparent"),n.addColorStop(1,c),t.strokeStyle=n,t.stroke()}drawStableScore(t){l(t,this)}constructor(e,n,o){this.r=o,this.stableScore=0,this.hasLeastStableScore=!1,this.position=new i(e,n),this.velocity=new i(t(-4,4),t(-4,4)),this.r=o,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}}const d=1;let f=.35;const w=5e3,m=1e3,v=.2;function y(t,e){return n=t.clientX,i=t.clientY,o=e.clientX,s=e.clientY,Math.sqrt(Math.pow(n-o,2)+Math.pow(i-s,2));var n,i,o,s}function p(){return.18/(Math.abs(-1.55/f)/15.5)}const x=.01,b=.5;function g(t,n){if(!e.dragWithMouseOver)return;const i=t(n);return function(t){const e=i.sub(t.position),n=o.length(e),s=t.r;n<s&&(t.position=t.position.add(e.mul(x*(s-n))),t.velocity=t.velocity.add(e.mul(b*(s-n))))}}function L(t,e,n=!1){window.addEventListener(n?"keydown":"keyup",(n=>{n.code!==t&&n.key!==t||e()}))}function S(t,e=300){function n(n){const i=()=>{t(n),s()};function o(){window.removeEventListener("touchend",i)}function s(){window.removeEventListener("touchmove",o)}window.addEventListener("touchend",i,{once:!0}),window.addEventListener("touchmove",o,{once:!0}),setTimeout((()=>{o(),s()}),e)}return window.addEventListener("touchstart",n),n}let E;const _={increment:"]",decrement:"[",incrementFast:"}",decrementFast:"{"},M={increment:"ArrowUp",decrement:"ArrowDown",rotateLeft:"ArrowLeft",rotateRight:"ArrowRight"},P={default:.1,fast:.3},C={default:.2};function R(t,e){const n=t.r+t.r*e;t.r=Math.max(n,5)}function T(t,e){if(E)e(E);else for(const n of t)e(n)}function A(t){t.velocity=t.velocity.mul(1+C.default)}function k(t){t.velocity=t.velocity.mul(1-C.default)}function z(t){t.velocity=o.rotate(t.velocity,C.default,o.RotationDirection.Left)}function q(t){t.velocity=o.rotate(t.velocity,C.default,o.RotationDirection.Right)}const B=document.querySelector("canvas"),D=B.getContext("2d");function F(){B.width=window.innerWidth,B.height=window.innerHeight}F(),window.addEventListener("resize",F),function(){let t=.1;function e(e){t+=e,t<0&&(t=0),t>1&&(t=1),f=2.9*t+.1}window.addEventListener("wheel",(({deltaY:t})=>{e(-t/w*p())})),null!==navigator.userAgent.match(/iPhone|iPad|iPod/i)?window.addEventListener("touchmove",(t=>{(function(t){return void 0!==t.scale})(t)&&(function(t){t.scale!==d&&t.preventDefault()}(t),f=function(t){const e=t-d,n=p()*v,i=f+e*v*n;return Math.min(3,Math.max(.1,i))}(t.scale))}),{passive:!1}):function(){let t=null;window.addEventListener("touchstart",(({touches:e})=>{e.length>1&&(t=y(e[0],e[1]))})),window.addEventListener("touchend",(()=>{t=null})),window.addEventListener("touchmove",(({touches:n})=>{if(null!==t){e((y(n[0],n[1])-t)/m)}}))}()}();let $=1,G=1,I=1,Y=1;const W=[];for(let e=0;e<20;e++){const e=t(0,2*Math.PI),n=350,i=n*Math.cos(e),o=n*Math.sin(e);W.push(new h(i+.5*B.width,o+.5*B.height,t(70,5)))}var X,O,V,H;function U(){Y=1===$?10:1}X=W,O=Q,V=70,H=5,window.addEventListener("contextmenu",(e=>{e.preventDefault();const n=O(e),i=new h(n.x,n.y,t(V,H));(function(t,e){const n=t.find((t=>t.hasLeastStableScore));n&&(e.stableScore=n.stableScore)})(X,i),X.push(i)})),function(t,e,n){function i(i){const o=e(i);!function(t){if(!t)return;E=E===t?null:t}(n(o,t))}window.addEventListener("click",i),S((t=>{if(1!==t.touches.length)return;const e=t.touches[0];i({x:e.clientX,y:e.clientY})})),L("Escape",(()=>{E=null}))}(W,Q,(function(t,e){for(const n of e){const e=t.sub(n.position);if(o.length(e)<n.r)return n}return null})),function(t){!function(t){L(_.increment,(()=>{T(t,(t=>{R(t,P.default)}))}),!0),L(_.decrement,(()=>{T(t,(t=>{R(t,-P.default)}))}),!0),L(_.incrementFast,(()=>{T(t,(t=>{R(t,P.fast)}))}),!0),L(_.decrementFast,(()=>{T(t,(t=>{R(t,-P.fast)}))}),!0)}(t),function(t){L(M.increment,(()=>{T(t,A)}),!0),L(M.decrement,(()=>{T(t,k)}),!0),L(M.rotateLeft,(()=>{T(t,z)}),!0),L(M.rotateRight,(()=>{T(t,q)}),!0)}(t)}(W),L("Space",U),function(t,e=500,n=200){function i(i){const o=setTimeout((()=>{setTimeout((()=>{t(i)}),n),window.removeEventListener("touchend",s),window.removeEventListener("touchmove",r)}),e);function s(){c(),window.removeEventListener("touchmove",r)}function r(){c(),window.removeEventListener("touchend",s)}function c(){clearTimeout(o)}window.addEventListener("touchend",s,{once:!0}),window.addEventListener("touchmove",r,{once:!0})}window.addEventListener("touchstart",i)}(U),L("a",(function(){e.drawTraces=!e.drawTraces}));let j=0;const J={x:0,y:0};window.addEventListener("mousemove",(t=>{J.x=t.x,J.y=t.y}));let K;function N(){return[-(t=E?E.position:K).x+.5*B.width/f,-t.y+.5*B.height/f];var t}function Q(t){const e=new i(t.x,t.y),[n,o]=N(),s=new i(n,o);return e.div(f).sub(s)}function Z(t,n,i){const s=t.position.sub(n.position),r=o.length(s),c=t.r+n.r;r<c&&(null==i||i(),function(t,n,i,o,s){const r=t.div(n);o.position=o.position.add(r.mul(.5*(i-n))),s.position=s.position.sub(r.mul(.5*(i-n))),e.useAntiCollisionBug||(o.velocity=o.velocity.add(r.mul(.5*(i-n))),s.velocity=s.velocity.sub(r.mul(.5*(i-n))))}(s,r,c,t,n))}new class{cycle(t){this.animation_frame_request=window.requestAnimationFrame(this.startCycle),this.accumulated_time+=t-this.time,this.time=t;let e=!1;for(this.accumulated_time>1e3&&(this.accumulated_time=this.time_step);this.accumulated_time>this.time_step;)this.accumulated_time-=this.time_step,this.update(t),e=!0;e&&this.render()}start(){this.animation_frame_request=window.requestAnimationFrame(this.startCycle)}stop(){window.cancelAnimationFrame(this.animation_frame_request)}constructor(t,e,n){this.update=t,this.render=e,this.time_step=n,this.animation_frame_request=void 0,this.accumulated_time=n,this.time=0,this.startCycle=t=>{this.cycle(t)}}}((function(t){I!==Y&&(I+=Y-I);let e=!0;if(!G){for(const t of W)t.stable=!0,t.save();e=function(t,e){let n=!0;a(t);const o=t.length,s=.01,r=new i(.5*B.width,.5*B.width),c=g(Q,J);for(let e=0;e<o;e++){const i=t[e],a=r.sub(i.position);i.velocity=i.velocity.add(a.mul(s)),null==c||c(i);for(let s=e+1;s<o;s++){const e=t[s],o=()=>{n=!1,i.stable=!1,e.stable=!1};Z(i,e,o)}}for(let e=0;e<o;e++)t[e].stable?t[e].stableCount++:t[e].stableCount=0,u(t[e]);return n}(W),!e&&j<200&&(j=0),e&&++j,I&&($=I),G=$}(function(t,e){const n=.016;for(const i of t)i.position=i.position.add(i.velocity.mul(n/e));G--})(W,$),K=new i(0,0);for(const t of W){const e=j>199?1:Math.min(1,t.stableCount/255),n=s.mul(e).add(r.mul(1-e));let i=t.r;$>1&&(i=t.r),K=K.add(t.position),t.color=n}K=K.div(W.length)}),(function(){D.clearRect(0,0,B.width,B.height),D.save(),D.scale(f,f),D.translate(...N()),W.forEach((t=>t.draw(D))),D.fillStyle="purple",D.beginPath(),D.arc(K.x,K.y,10,0,2*Math.PI),D.fill(),D.closePath(),D.restore()}),1e3/60).start();