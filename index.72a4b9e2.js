function t(t,i){return Math.random()*(i-t)+t}const i={drawTraces:!0,useAntiCollisionBug:!0,strokeBalls:!1,dragWithMouseOver:!1};window.settings=i;class o{constructor(t,i,o){this.x=t,this.y=i,this.z=o}add(t){return new o(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new o(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new o(this.x*t,this.y*t,this.z*t)}div(t){return new o(this.x/t,this.y/t,this.z/t)}toRGB(){return`rgb(${this.x} ${this.y} ${this.z})`}toRGBA(t){return`rgba(${this.x}, ${this.y}, ${this.z}, ${t})`}}class n{constructor(t,i){this.x=t,this.y=i}add(t){return new n(this.x+t.x,this.y+t.y)}sub(t){return new n(this.x-t.x,this.y-t.y)}mul(t){return new n(this.x*t,this.y*t)}div(t){return new n(this.x/t,this.y/t)}}const e=new o(0,255,0),s=new o(255,0,0),r=e.toRGB();class h{constructor(i,o,e){this.r=e,this.position=new n(i,o),this.velocity=new n(t(-4,4),t(-4,4)),this.r=e,this.position_history=Array(100).fill(this.position),this.current_idx=0,this.stableCount=0}save(){this.position_history[this.current_idx]=this.position,this.current_idx=++this.current_idx%100}getVA(){const t=[];for(let i=0;i<100;++i){const n=(i+this.current_idx)%100,e=i/100;t[i]||(t[i]={}),t[i].position=this.position_history[n];const s=255*e;t[i].color=new o(0,s,0)}return t}draw(t){i.drawTraces&&this.drawTrace(t),t.fillStyle=this.color.toRGB(),t.beginPath(),t.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),i.strokeBalls&&this.drawStroke(t),t.fill(),t.closePath()}drawStroke(t){t.strokeStyle="#000a",t.stroke()}drawTrace(t){const i=this.getVA(),o=i[0].position;t.beginPath(),i.forEach((i=>{t.lineTo(i.position.x,i.position.y)})),t.lineTo(this.position.x,this.position.y),t.moveTo(o.x,o.y),t.closePath(),this.applyTraceColor(t,o)}applyTraceColor(t,i){const o=t.createLinearGradient(i.x,i.y,this.position.x,this.position.y);o.addColorStop(0,"transparent"),o.addColorStop(1,r),t.strokeStyle=o,t.stroke()}}let l=.35;const a=.01,c=.5;function d(t,o){if(!i.dragWithMouseOver)return;const n=t(o);return function(t){const i=n.sub(t.position),o=Math.sqrt(i.x*i.x+i.y*i.y),e=t.r;o<e&&(t.position=t.position.add(i.mul(a*(e-o))),t.velocity=t.velocity.add(i.mul(c*(e-o))))}}const u=document.querySelector("canvas"),w=u.getContext("2d");function y(){u.width=window.innerWidth,u.height=window.innerHeight}y(),window.addEventListener("resize",y),function(){let t=.1;window.addEventListener("wheel",(({deltaY:t})=>{o(-t/5e3)}));let i=null;function o(i){t+=i,t<0&&(t=0),t>1&&(t=1),l=2.9*t+.1}window.addEventListener("touchstart",(({touches:t})=>{t.length>1&&(i=Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2)))})),window.addEventListener("touchend",(()=>{i=null})),window.addEventListener("touchmove",(({touches:t})=>{if(null!==i){o((Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))-i)/1e3)}}))}();let p=1,x=1,f=1,v=1;const m=[];for(let i=0;i<20;i++){const i=t(0,2*Math.PI),o=350,n=o*Math.cos(i),e=o*Math.sin(i);m.push(new h(n+.5*u.width,e+.5*u.height,t(70,5)))}var b,g,M,k;b=m,g=S,M=70,k=5,window.addEventListener("click",(i=>{const o=g(i);b.push(new h(o.x,o.y,t(M,k)))})),L("Space",(function(){v=1===p?10:1})),L("a",(function(){i.drawTraces=!i.drawTraces}));let C=0;const T={x:0,y:0};let z;function E(){return[-z.x+.5*u.width/l,-z.y+.5*u.height/l]}function S(t){const i=new n(t.x,t.y),[o,e]=E(),s=new n(o,e);return i.div(l).sub(s)}function L(t,i){window.addEventListener("keyup",(o=>{o.code!==t&&o.key!==t||i()}))}window.addEventListener("mousemove",(t=>{T.x=t.x,T.y=t.y})),window.requestAnimationFrame((function t(o){f!==v&&(f+=v-f);let r=!0;if(!x){for(const t of m)t.stable=!0,t.save();r=function(t,o){let e=!0;const s=t.length,r=.01,h=new n(.5*u.width,.5*u.width),l=d(S,T);for(let o=0;o<s;o++){const n=t[o],a=h.sub(n.position);n.velocity=n.velocity.add(a.mul(r)),l?.(n);for(let r=o+1;r<s;r++){const o=t[r],s=n.position.sub(o.position),h=Math.sqrt(s.x*s.x+s.y*s.y),l=n.r+o.r;if(h<l){e=!1,n.stable=!1,o.stable=!1;const t=s.div(h);n.position=n.position.add(t.mul(.5*(l-h))),o.position=o.position.sub(t.mul(.5*(l-h))),i.useAntiCollisionBug||(n.velocity=n.velocity.add(t.mul(.5*(l-h))),o.velocity=o.velocity.sub(t.mul(.5*(l-h))))}}}for(let i=0;i<s;i++)t[i].stable?t[i].stableCount++:t[i].stableCount=0;return e}(m),!r&&C<200&&(C=0),r&&++C,f&&(p=f),x=p}(function(t,i){const o=.016;for(const n of t)n.position=n.position.add(n.velocity.mul(o/i));x--})(m,p),z=new n(0,0);for(const t of m){const i=C>199?1:Math.min(1,t.stableCount/255),o=e.mul(i).add(s.mul(1-i));let n=t.r;p>1&&(n=t.r),z=z.add(t.position),t.color=o}z=z.div(m.length),w.clearRect(0,0,u.width,u.height),w.save(),w.scale(l,l),w.translate(...E()),m.forEach((t=>t.draw(w))),w.fillStyle="purple",w.beginPath(),w.arc(z.x,z.y,10,0,2*Math.PI),w.fill(),w.closePath(),w.restore(),window.requestAnimationFrame(t)}));